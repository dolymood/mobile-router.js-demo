!function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define("m",function(exports){return t(e,exports)}):e.M=t(e,{})}(this,function(e,t){function n(e){if(!("classList"in e)){e.classList={node:e};for(var t in D)e.classList[t.slice(1)]=D[t]}return e.classList}var r=function(e,t,n){n||(n=null);for(var r=0,i=e.length;i>r&&!1!==t.call(n,e[r],r,e);r++);},i=function(e){return e+="",e.replace(/#.*/,"")},a=e.location,o=e.document,s=o.body,c=o.createElement("a"),l=function(e){return c.href=e,d(c)},u=function(e){return c.href=e,i(c.href)},h=function(e){return e||(e=a),e.hash.substr(1)},d=function(e){return e||(e=a),{url:e.href,rurl:i(e.href),host:e.host,hash:h(e),protocol:e.protocol,origin:e.origin||e.protocol+"//"+e.host,pathname:e.pathname,search:e.search,port:e.port}},f=function(e){var t="";do if(e!==s&&1===e.nodeType&&((t=e.getAttribute("data-href"))||(t=e.href)))break;while(e=e.parentElement);return{href:t||"",target:e}},p=function(e){return e.indexOf("-")<0?e:e.replace(/-[^-]/g,function(e){return e.charAt(1).toUpperCase()})},g=function(e){var t={};if(e.dataset)for(var n in e.dataset)t[n]=e.dataset[n];else for(var r,i,a=e.attributes,o=/^data-(.+)$/i,s=0,c=a.length;c>s;s++)r=a[s].name||a[s].nodeName,(i=r.match(o))&&(t[p(i[1])]=a[s].value||a[s].nodeValue);return t},m=Object.prototype,v=(m.hasOwnProperty,m.toString),y=function(e){return"[object Function]"==v.call(e)},b=function(e){return"[object Object]"===v.call(e)&&Object.getPrototypeOf(e)===m},C=t.extend=function(){var e,t,n,r,i,a,o=arguments[0]||{},s=1,c=arguments.length,l=!1;for("boolean"==typeof o&&(l=o,o=arguments[1]||{},s++),"object"==typeof o||y(o)||(o={}),s===c&&(o=this,s--);c>s;s++)if(null!=(e=arguments[s]))for(t in e)n=o[t],r=e[t],o!==r&&(l&&r&&(b(r)||(i=Array.isArray(r)))?(i?(i=!1,a=n&&Array.isArray(n)?n:[]):a=n&&b(n)?n:{},o[t]=C(l,a,r)):void 0!==r&&(o[t]=r));return o},w={_eventData:null,on:function(e,t){this._eventData||(this._eventData={}),this._eventData[e]||(this._eventData[e]=[]);var n=!1;r(this._eventData[e],function(e){return e===t?(n=!0,!1):void 0}),n||this._eventData[e].push(t)},off:function(e,t){this._eventData||(this._eventData={}),this._eventData[e]&&this._eventData[e].length&&(t?r(this._eventData[e],function(n,r){return n===t?(this._eventData[e].splice(r,1),!1):void 0}):this._eventData[e]=[])},trigger:function(e){if(this._eventData||(this._eventData={}),this._eventData[e]){var t=this._eventData[e].slice.call(arguments,1);r(this._eventData[e],function(e){e.apply(null,t)})}}},_=function(){},S="m-"+(new Date).getTime()+"-",E=1,k={},O=function(e){var t="";return e&&(t=k[e])||(t=S+E++,e&&(k[e]=t)),t},x=/[^, ]+/g,D={_toString:function(){var e=this.node,t=e.className,n="string"==typeof t?t:t.baseVal;return n.split(/\s+/).join(" ")},_contains:function(e){return(" "+this+" ").indexOf(" "+e+" ")>-1},_add:function(e){this.contains(e)||this._set(this+" "+e)},_remove:function(e){this._set((" "+this+" ").replace(" "+e+" "," "))}};return"add,remove".replace(x,function(e){t[e+"Class"]=function(t,r){return r&&"string"==typeof r&&t&&1===t.nodeType&&r.replace(/\S+/g,function(r){n(t)[e](r)}),this}}),t.innerHTML="undefined"!=typeof $&&y($.prototype.html)?function(e,t){$(e).html(t)}:function(){function e(e){"string"!=typeof e&&(e+=""),e=e.replace(a,"<$1></$2>").trim();var t,o=(i.exec(e)||["",""])[1].toLowerCase(),u=n[o]||n._default,h=l.cloneNode(!1);u.innerHTML=e;{var d=u.getElementsByTagName("script");[].forEach}if(d.length)for(var f,p,g=0;f=d[g++];)s[f.type]&&(p=c.cloneNode(!1),r(f.attributes,function(e){p.setAttribute(e.name,e.value)}),p.text=f.text,f.parentNode.replaceChild(p,f));for(;t=u.firstChild;)h.appendChild(t);return h}var n=new function(){t.extend(this,{option:o.createElement("select"),thead:o.createElement("table"),td:o.createElement("tr"),area:o.createElement("map"),tr:o.createElement("tbody"),col:o.createElement("colgroup"),legend:o.createElement("fieldset"),_default:o.createElement("div"),g:o.createElementNS("http://www.w3.org/2000/svg","svg")}),this.optgroup=this.option,this.tbody=this.tfoot=this.colgroup=this.caption=this.thead,this.th=this.td};"circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use".replace(x,function(e){n[e]=n.g});var i=/<([\w:]+)/,a=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,s={"":1,"text/javascript":1,"text/ecmascript":1,"application/ecmascript":1,"application/javascript":1},c=o.createElement("script"),l=o.createDocumentFragment();return function(t,n){var r=e(n);t.innerHTML="",t.appendChild(r),r=null}}(),t.extend({rword:x,noop:_,each:r,trimUrl:i,parseUrl:l,getHash:h,getFullUrl:u,getHrefAndTarget:f,camelize:p,getDatesetObj:g,isFunction:y,isArray:function(e){return Array.isArray(e)},isString:function(e){return"string"==typeof e},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e},isPlainObject:b,parseLocation:d,getUIDByKey:O,hasClass:function(e,t){return 1===e.nodeType&&n(e).contains(t)},location:a,document:o,body:s,html:o.documentElement,Base:w,extendByBase:function(e){return C(e,w)},Array:{ensure:function(e,t){return-1===e.indexOf(t)?e.push(t):void 0},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,n){var r=e.indexOf(n);return~r?t.Array.removeAt(e,r):!1},indexOfByKey:function(e,t,n){for(var r=t[n],i=0,a=e.length;a>i;i++)if(e[i][n]===r)return i;return-1}},Object:{create:Object.create||function(e){return{__proto__:e}},setPrototypeOf:Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},getPrototypeOf:Object.getPrototypeOf||function(e){return e.__proto__}}}),t}),function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define("m.history",function(require){var n=require("m");return n.history=t(e,n),n}):M.history=t(e,e.M)}(this,function(e,t){var n={},r=[],i=function(e){return("/"+e+"/").replace(/^\/+|\/+$/g,"/")},a=t.document.getElementsByTagName("base");a=a&&a.length?i(a[0].getAttribute("href")):"/";var o=t.parseLocation().origin,s=e.history,c=(e.navigator||{}).userAgent;c||(c="");var l=parseInt((/android (\d+)/.exec(c.toLowerCase())||[])[1],10);isNaN(l)&&(l=void 0);var u=/Boxee/i.test(c),h=!(!(s&&s.pushState&&s.replaceState)||4>l||u),d={support:h,_startd:!1,index:-1,base:a,start:function(n){if(!this._startd){n||(n={});var r=n.base;t.isDefined(r)&&t.isString(r)&&(this.base=i(r)),this._startd=!0,this.options=t.extend({enablePushState:!0},n),h&&(this.options.enablePushState&&e.addEventListener("popstate",this.onChange),t.document.addEventListener("click",this.onDocClick)),this.onChange({type:"popstate",state:d.getUrlState(t.location.href)}),this.trigger("inited")}},stop:function(){h&&(this.options.enablePushState&&e.removeEventListener("popstate",this.onChange),t.document.removeEventListener("click",this.onDocClick)),this._startd=!1,this.index=-1,n={},r=[]},getPath:function(e){var n=t.parseUrl(e),r=decodeURIComponent(n.pathname+n.search),i=this.base.slice(0,-1);return r.indexOf(i)||(r=r.slice(i.length)),r.slice(1)},onDocClick:function(e){if(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)return!0;var n=e.target,r=t.getHrefAndTarget(n);n=r.target;{var i=r.href;t.parseUrl(i)}if(d.checkUrl(i)&&!n.target){var a=t.getDatesetObj(n),o=d.createStateObject(i,a);return e.preventDefault(),d.pushState(o,!0),!1}},checkUrl:function(e,n){n||(n=t.parseUrl(e).origin);var r=/^javascript:/;return e&&o===n&&!r.test(e)},push:function(e,t){var n=this.createStateObject(e,t);this.pushState(n)},pushState:function(e,t){(t||this.checkUrl(e.url,e.origin)&&e.url!==d.getCurrentState().url)&&(this.options.enablePushState&&s["true"==e.replace?"replaceState":"pushState"](e,e.title,e.url),this.onChange({state:e}))},onChange:function(e){var n,r=e&&e.state||d.getUrlState(t.location.href),i=d.getCurrentState();if(i&&r.rurl===i.rurl)return void("popstate"!==e.type&&r.hash&&(n=t.document.getElementById(r.hash),n&&n.scrollIntoView()));var a=d.storeState(r),o="";if(a>d.index)o="forward";else{if(!(a<d.index))return e.preventDefault(),!1;o="back"}t.document.title=r.title,d.index=a,d.trigger(o,r,i),d.trigger("change",o,r,i)},getUrlState:function(e){return e=t.getFullUrl(e),n[e]||this.createStateObject(e)},getCurrentState:function(){var e=r[this.index];return e?n[e]||null:null},getPrevState:function(){var e=r[this.index-1];return e?n[e]||null:null},createStateObject:function(e,n,r){e?"/"===e.charAt(0)&&(e=e.slice(1)):e=t.location.href;var i=t.parseUrl(e);return{data:n||(n={}),title:r||n.title||t.document.title,rurl:i.rurl,url:i.url,origin:i.origin,hash:i.hash}},hasUrl:function(e){return!!n[e]},storeState:function(e){var i=-1,a=e.rurl;return this.hasUrl(a)?i=r.indexOf(a):(r.push(a),i=r.length-1),n[a]=t.extend(!0,n[a],e),this.clearCache(i),i},clearCache:function(e){t.isUndefined(e)&&(e=-1);var i=r.slice(e+1);i.forEach(function(e){delete n[e]}),r.length=e+1},getCache:function(){return{urlCache:r,stateCache:n}}};return t.extendByBase(d),d}),function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define("m.router",function(require){var n=require("m.history");return n.router=t(e,n,n.history),n}):M.router=t(e,M,M.history)}(this,function(e,t,n){function r(e,t,n){var r=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return r;var i=n?"?":"";return r+i+"("+t+")"+i}var i=function(e){var t=e.split("?"),n={},r=t[0],i=t[1];if(i)for(var a,o=i.split("&"),s=o.length,c=0;s>c;c++)o[c]&&(a=o[c].split("="),n[decodeURIComponent(a[0])]=decodeURIComponent(a[1]));return{path:r,query:n}},a=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,o={},s=[],c={},l=!1,u={cacheTemplate:!0,viewsSelector:"",viewClass:"page-view",animation:!0,aniClass:"slide",maskClass:"mask",showLoading:!0,cacheViewsNum:3},h=t.document.createElement("div"),d=function(){for(var e,t=h.style,n=["a","webkitA","MozA","OA","msA"],r=["animationend","webkitAnimationEnd","animationend","oAnimationEnd","MSAnimationEnd"],i=0,a=n.length;a>i;i++)if(e=n[i]+"nimation",e in t)return r[i];return"animationend"}(),f={options:u,maskEle:null,viewsContainer:null,init:function(e,n){if(!l&&(e||n)){l=!0,t.isArray(e)||(n=e,e=[]),e.forEach(function(e){var t=e.path;e.pattern=t,delete e.path,this.add(e.method||"get",t||"/",e.callback,e)},this),n&&t.isFunction(n.error)&&(this.error(n.error),delete n.error),t.extend(this.options,n||{}),this.options.cacheViewsNum<1&&(this.options.cacheViewsNum=1),h.className=this.options.maskClass,h.innerHTML='<i class="'+this.options.maskClass+'-loading"></i>';var r=this.options.viewsSelector,i=r&&t.document.querySelector(r);i||(i=t.document.body),this.viewsContainer=i}},animate:function(e){this.options.animation=!!e},errorback:null,error:function(e){this.errorback=e},showLoading:function(){this.options.showLoading&&(this.maskEle||(this.maskEle=h,t.body.appendChild(h)),this.maskEle.style.visibility="visible")},hideLoading:function(){this.maskEle&&(this.maskEle.style.visibility="hidden")},_pathToRegExp:function(e,t){for(var n,i,o,s,c=t.keys=[],l="boolean"==typeof t.caseInsensitive?t.caseInsensitive:!0,u="^",h=0;n=a.exec(e);){i=n[2]||n[3],o=n[4]||("*"==n[1]?".*":"string"),s=e.substring(h,n.index);var d=this.$types[o],f={name:i};d&&(o=d.pattern,f.decode=d.decode),c.push(f),u+=r(s,o,!1),h=a.lastIndex}return s=e.substring(h),u+=r(s)+(t.strict?t.last:"/?")+"$",t.regexp=new RegExp(u,l?"i":void 0),t},add:function(e,n,r,i){var a=o[e.toLowerCase()];if(a||(a=o[e.toLowerCase()]=[]),"/"!==n.charAt(0))throw"path必须以/开头";"object"==typeof r&&(i=r),i=i||{},i.callback=r||t.noop,n.length>2&&"/"===n.charAt(n.length-1)&&(n=n.slice(0,-1),i.last="/"),t.Array.ensure(a,this._pathToRegExp(n,i))},pageViewState:null,route:function(e,n,r,i){function a(e){f.getTemplateCb(l,e,h)}n=n.trim();var s=o[e];i||(i={});for(var l,u=0;l=s[u++];){var h=n.match(l.regexp);if(h){if(l.element){for(var d=!1;l;){if(l.path===n){d=!0;break}if(!l.child)break;l=l.child}if(!d){var p=l;l=t.Object.create(p),["cacheTemplate","callback","getTemplate","keys","onDestroy","pattern","regexp"].forEach(function(e){l[e]=p[e]}),l.child=null,p.child=l}}l.query=r||{},l.path=n,l.params={},l.historyOptions=i;var g=l.keys;h.shift(),g.length&&this._parseArgs(h,l);var m=this.getOption(l,i.state,"cacheTemplate");if(i.first){var v=t.document.getElementsByClassName(this.options.viewClass)[0];v&&(c[l.path]=v.innerHTML,m=!0)}return t.isString(m)&&(m="true"===m),m&&c[l.path]||!l.getTemplate?(this.trigger("routeChangeStart",l,h),a(c[l.path])):(this.trigger("routeChangeStart",l,h),this.showLoading(),void(l.getTemplate.length?l.getTemplate(a):a(l.getTemplate())))}}this.errorback&&this.errorback()},getOption:function(e,n,r){if(!e&&!n)return void 0;if(!r)return void 0;var i;return n&&(i=n.data[r]),t.isUndefined(i)&&(i=e[r],t.isUndefined(i)&&(i=this.options[r])),i},getTemplateCb:function(e,n,r){function i(n){e.element=n;var i=t.Array.indexOfByKey(s,e,"path");~i&&s.splice(i,1),s.push(e),l.pageViewState=e,e.callback.apply(e,r),l.trigger("routeChangeEnd",e,r)}function a(){A&&L&&l.checkPageViews()}this.hideLoading(),e._oldTemplate=c[e.path],c[e.path]=n;var o,l=this,u=this.options,h=this.pageViewState,f=e.historyOptions,p=f.first||!h,g=t.getUIDByKey(e.path);p&&(o=t.document.getElementsByClassName(u.viewClass)[0]);var m="in",v="out",y="init",b=v,C="reverse",w="ani",_=m+" "+C,S=t.document.getElementById(g);S?e.cached=!0:(S=o||t.document.createElement("div"),S.id=g,e.cached=!1,!o&&this.viewsContainer.appendChild(S)),e.cached&&n===e._oldTemplate||(t.innerHTML(S,n),e.cached=!1),t.removeClass(S,_),t.addClass(S,u.viewClass+" "+b),p&&(m+=" "+y);var E=u.animation;if(E){var k=w,O=w;p||(k+=" "+this.getOption(e,f.state,"aniClass"),O+=" "+this.getOption(this.pageViewState,f.oldState,"aniClass")),m=k+" "+m,v=O+" "+v}if("back"===f.direction&&(m+=" "+C,v+=" "+C),h&&(t.removeClass(h.element,_),t.addClass(h.element,v)),t.removeClass(S,b),t.addClass(S,m),!e.cached){var x,D=f.state.hash;D&&(x=t.document.getElementById(D),x&&x.scrollIntoView())}var A=!1,L=!1;return E?(S.addEventListener(d,function T(){A=!0,S.removeEventListener(d,T),t.removeClass(S,k+" "+y),i(S),a(),T=null,S=null}),void(h&&h.element.addEventListener(d,function j(){L=!0,h.element.removeEventListener(d,j),t.removeClass(h.element,O),a(),j=null,h=null}))):(A=!0,L=!0,i(S),void a())},checkPageViews:function(){var e=this.options.cacheViewsNum;if(!(s.length<=e)){var n=t.Array.indexOfByKey(s,this.pageViewState,"path"),r=0,i=0;for(r=n-Math.floor((e-1)/2),0>r&&(r=0),i=e-1+r,i>s.length-1&&(r-=i-s.length+1,i=s.length-1);r>0;)this.destroyState(s.shift()),r--,i--;for(;i<s.length-1;)this.destroyState(s.pop())}},destroyState:function(e){t.isFunction(e.onDestroy)&&e.onDestroy(),e.element&&e.element.parentNode.removeChild(e.element),e.element=null,e.child&&(t.Object.setPrototypeOf(e.child,null),t.extend(e,e.child));var n=t.Object.getPrototypeOf(e);n&&n.child&&(n.child=null),t.Object.setPrototypeOf(e,null),e=null},_parseArgs:function(e,t){for(var n=t.keys,r=0,i=n.length;i>r;r++){var a=n[r],o=e[r]||"";if("function"==typeof a.decode)var s=a.decode(o);else try{s=JSON.parse(o)}catch(c){s=o}e[r]=t.params[a.name]=s}},navigate:function(e,t){"/"===e.charAt(1)&&(e=e.slice(1)),n.push(e,t)},$types:{date:{pattern:"[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])",decode:function(e){return new Date(e.replace(/\-/g,"/"))}},string:{pattern:"[^\\/]*"},bool:{pattern:"0|1",decode:function(e){return 0===parseInt(e,10)?!1:!0}},"int":{pattern:"\\d+",decode:function(e){return parseInt(e,10)}}}};return f.get=function(e,t,n){this.add("get",e,t,n)},t.extendByBase(f),n.on("change",function(e,t,r){var a=!1;r||(a=!0),"back"!==e&&"back"===t.data.rel?e="back":"back"===e&&"back"!==t.data.rel&&"back"===r.data.rel&&(e="forward");var o=t.url,s=n.getPath(o);if(s||n.base||a){s&&"/"===s||(s="/"+(s||""));var c=i(s);f.route("get",c.path,c.query,{first:a,direction:e,state:t,oldState:r})}}),f});